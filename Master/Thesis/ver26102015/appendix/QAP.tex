\chapter{Quadratic Assignment Problem}\label{appendixA}
Consider a problem of assignment of $n$ facilities to $n$ locations given the transportation costs between the locations depending on the flow between them and opening costs of facilities in certain locations. The aim is the cost minimization of the assignment. Let $D=(d_{kl}),F=(f_{kl}), B=(b_{ik})\in\mathbb{R}^{n\times n}$ be real matrices that define a distances and flow between the locations, as well as the opening costs. The problem defined above can then be formulated as an integer quadratic program~\cite{Burkard98thequadratic,Koopman_Backman}:
\begin{equation}\label{eq:QAP_classic}
P = \argmin_{\hat{\sigma}\in\Sigma_n}\sum_{i=1}^{n}\sum_{j=1}^{n}f_{ij}d_{\hat{\sigma}(i)\hat{\sigma}(j)}+\sum_{i=1}^{n}b_{i\hat{\sigma}(i)},
\end{equation}
where $\Sigma_n$ is a set of all possible permutations of the set $\{1,\dots,n\}$. Eq.~\eqref{eq:QAP_classic} is called \emph{Koopmans-Beckmann version of the quadratic assignment problem}~\cite{Burkard98thequadratic} (further \emph{QAP}).

We can assign a permutation matrix $P=(P_{ij})\in\{0,1\}^{n\times n}$ to each permutation $\sigma$, where $P_{i\sigma(i)}=1$ and $0$ elsewhere. The set of all feasible permutation matrices is defined as
\begin{equation*}
\Pi_n=\{P\in\{0,1\}^{n\times n}|\sum_{i=1}^{n}P_{ij}=\sum_{j=1}^{n}P_{ij}=1\quad\forall i,j=1,\dots,n\}.
\end{equation*}
It is easy to see that, the formulation in Eq.~\eqref{eq:QAP_classic} %with zero-matrix $B$
is equivalent to
\begin{equation}\label{eq:QAP_classic2}
P = \argmin_{\hat{P}\in\Pi_n}(F\cdot \hat{P}D\hat{P}^T)+B\cdot\hat{P},
\end{equation}
where $\cdot$ denotes the Frobenius inner product of two square matrices defined as $A\cdot B=\sum_{i=1}^{n}\sum_{j=1}^{n}A_{ij}B_{ij}$.

We recall shortly the definition of the Kronecker product of two matrices and it's connection with the Frobenius inner product of two matrices and matrix trace.

The Kronecker  product of two matrices $A=\{A_{ij}\},B=\{B_{ij}\}\in\mathbb{R}^{n,n}$ is a new $n^2\times n^2$ matrix C
\begin{equation}\label{eq:kronecker}
C=A\otimes B =  	
\begin{pmatrix} a_{11}B & \dots & a_{n1}B \\ \vdots & \ddots & \vdots \\ a_{1n}B & \dots & a_{nn}B  \end{pmatrix}.
\end{equation}

From the definition of the matrix trace follows:
\begin{equation}\label{eq:Property1}
A\cdot B=\sum_{i=1}^{n}\sum_{j=1}^{n}A_{ij}B_{ij}=\sum_{i=1}^{n}(AB^T)_{ii}=\tr(AB^T).
\end{equation}
We also can write
\begin{equation}\label{eq:Property1.1}
A\cdot B=\sum_{i=1}^{n}\sum_{j=1}^{n}A_{ij}B_{ij}=\vec(A)^T\vec(B),
\end{equation}
where $\vec(A)$ denotes the column-wise vectorization of a matrix $A$. Additionally, it holds~\cite{Jain1989}:
\begin{equation}\label{eq:Property2}
\vec(APB)=(B^T\otimes A)\vec(P).
\end{equation}

We can now use Eq.~\eqref{eq:Property1} in Eq.~\eqref{eq:QAP_classic2} to obtain the~\emph{trace formulation of QAP}~\cite{Burkard98thequadratic}:
\begin{equation}\label{eq:QAP_classic3}
P = \argmin_{\hat{P}\in\Pi_n}\tr(F\hat{P}D^T\hat{P}^T+B\hat{P}^T).
\end{equation}
The objective function of the trace formulation of QAP can be further rewritten based on the properties in Eqs.~\eqref{eq:Property1.1} and \eqref{eq:Property2} as follows:
 \begin{align}\label{eq:QAP_classic4}
\tr(F\hat{P}D^T\hat{P}^T+B\hat{P}^T)&=\tr(\hat{P}(F\hat{P}D^T)^T)+\vec(B)^T\vec(\hat{P}) \notag\\	
									&=\vec(\hat{P})^T\vec(F\hat{P}D^T)+\vec(B)^T\vec(\hat{P}) \notag\\	
                                    &=\vec(\hat{P})^T(D\otimes F)\vec({\hat{P}})+\vec(B)^T\vec(\hat{P}).
\end{align}
Based on this formulation the matrix $B$ is called sometimes \emph{linear cost matrix} and the matrix $D\otimes F$ \emph{quadratic costs matrix}~\cite{Burkard98thequadratic,Roth2001}. If we replace the matrix $F$ with $-(A^I)^T$, the matrix $D$ with $(A^J)^T$ and the matrix $B$ with $D^I(D^J)^T$, we obtain the formulation in Eq.~\eqref{eq:QAP3} from chapter~\ref{chapter:GM}. Analog, if we define a matrix $S=(-D\otimes F)$ with the vector $\vec(B)$ on the diagonal, we come to the formulation in Eq.~\eqref{eq:gQAP1}.

It remains to show, that the problem in Eq.~\eqref{eq:QAP1} is equivalent to the trace formulation of QAP~\eqref{eq:QAP_classic3}. Indeed, consider the first term of the objective function in Eq.~\eqref{eq:QAP1}:
\begin{align*}
\|A^I-\hat{P}A^J\hat{P}^T\|^2 &= \tr((A^I-\hat{P}A^J\hat{P}^T)^T(A^I-\hat{P}A^J\hat{P}^T)) \notag\\
							  &= \tr(((A^I)^T-\hat{P}(A^J)^T\hat{P}^T)(A^I-\hat{P}A^J\hat{P}^T)) \notag\\
							  &= \tr((A^I)^TA^I-(A^I)^T\hat{P}A^J\hat{P}^T-\hat{P}(A^J)^T\hat{P}^TA^I+\hat{P}(A^J)\hat{P}^T\hat{P}A^JP^T) \notag\\
							  &= \tr((A^I)^TA^I-2(A^I)^T\hat{P}A^J\hat{P}^T+A^J(A^J)^T).
\end{align*}
The first and the last terms are obviously constant and thus can be ignored during optimization. Consequently, it holds:
\begin{equation}\label{eq:trace_1}
\argmin_{\hat{P}\in\Pi_n}\|A^I-\hat{P}A^J\hat{P}^T\|^2 = \argmin_{\hat{P}\in\Pi_n}-\tr((A^I)^T\hat{P}A^J\hat{P}^T).
\end{equation}
We perform the same transformations with the second term:
\begin{align*}
\|D^I-\hat{P}D^J\|^2 &= \tr((D^I-\hat{P}D^J)^T(D^I-\hat{P}D^J)) \notag\\
					 &= \tr((D^I)^TD^I)-2(D^I)^T\hat{P}D^J+(D^J)^TD^J) \notag\\
					 &= \tr((D^I)^TD^I)-2D^I(D^J)^T\hat{P}+(D^J)^TD^J) 
\end{align*} 
Also here the first and the last terms can be ignored during optimization, so that we can write:
\begin{equation}\label{eq:trace_2}
\argmin_{\hat{P}\in\Pi_n}\|D^I-\hat{P}D^J\|^2=\argmin_{\hat{P}\in\Pi_n}-\tr(D^I(D^J)^T\hat{P}).
\end{equation}
The combination of the results in Eqs.~\eqref{eq:trace_1} and~\eqref{eq:trace_2} with the substitution $F=-(A^I)^T$, $D=(A^J)^T$ and $B=-D^I(D^J)^T$ proof the equivalence of the problems~\eqref{eq:QAP1} and~\eqref{eq:QAP_classic3}. That is exactly, what we wanted to show.



